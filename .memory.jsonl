{"type":"entity","name":"Citadel Protocol","entityType":"project","observations":["Post-quantum secure networking protocol written in Rust","Supports both client-server and P2P architectures","Features patent-pending 3D matrix ratcheting algorithm","Provides multiple encryption layers and security modes (PFS and BEM)","Built-in NAT traversal with STUN/TURN","Includes Remote Encrypted Virtual Filesystem (RE-VFS)","Supports single-threaded and multi-threaded modes","Uses cargo-make for build automation","Main branch is 'master', not 'main'"],"createdAt":"2025-07-28T14:57:57.251Z","version":1}
{"type":"entity","name":"citadel_sdk","entityType":"crate","observations":["Main SDK crate providing high-level APIs","Entry point for most applications","Contains NodeBuilder for creating servers and clients","Includes RE-VFS implementation in src/fs/","Supports WebRTC integration via feature flag"],"createdAt":"2025-07-28T14:57:57.251Z","version":1}
{"type":"entity","name":"citadel_proto","entityType":"crate","observations":["Core protocol implementation","Handles networking, encryption, and session management","Implements the kernel pattern for event handling","Contains packet processing logic"],"createdAt":"2025-07-28T14:57:57.251Z","version":1}
{"type":"entity","name":"citadel_crypt","entityType":"crate","observations":["Cryptographic primitives and algorithms","Implements patent-pending ratcheting algorithms","Contains encryption toolsets and key management","Includes both mono and stacked ratchet implementations","Race condition exists in endpoint_crypto_container.rs get_ratchet() function when SecrecyMode::Perfect is used","Synchronization bug where latest_usable_version is incremented before toolset is actually updated, causing AEAD decryption failures","Bug manifests as attempting to get version N but toolset only has version N-1","Temporary workaround implemented to use adjusted_version = latest_ideal_ratchet.saturating_sub(1) when sync bug detected","Issue occurs in single-threaded mode when two nodes spam messages simultaneously","Bug leads to panics in citadel_proto's session.rs around line 2000 during message sending"],"createdAt":"2025-07-28T14:57:57.251Z","version":1}
{"type":"entity","name":"KyberHybrid Race Condition","entityType":"bug","observations":["Race condition occurs in citadel_crypt ratchet_manager tests with KyberHybrid + Dilithium65","AEAD decrypt_in_place fails with 'Error' during concurrent rekey operations","Test timeout after 5 seconds indicates possible deadlock","Issue appears related to larger Dilithium65 signature size (3293 bytes vs Falcon1024's 1280 bytes)","ScramCryptDictionary uses fixed 32-byte block size based on assumption of ~1100 byte Kyber output","Buffer operations use .unwrap() which can panic on capacity issues","Race condition manifests under min_delay_2_1 test configuration","Fixed by restructuring encryption flow to sign after encryption instead of before","Solution moves signature from being part of encrypted data to being appended after encryption","This keeps the scrambled data size consistent with original 32-byte block assumption","New data structure: [Encrypted+Scrambled Data][Encrypted Scramble Dict][Length][SHA-256][Signature][Sig Length]","All ratchet manager tests now pass including the previously failing min_delay_2_1 test"],"createdAt":"2025-07-30T20:18:17.994Z","version":1}
{"type":"entity","name":"Dilithium65 Integration","entityType":"feature","observations":["Successfully replaced Falcon1024 with Dilithium65 signature algorithm","Signature size increased from 1280 to 3293 bytes","All citadel_pqcrypto tests pass locally","Race condition only appears in GitHub pipeline under specific timing conditions","ml-dsa crate provides the Dilithium implementation"],"createdAt":"2025-07-30T20:18:17.994Z","version":1}
{"type":"entity","name":"PeerConnectionKernel Race Condition","entityType":"bug","observations":["Race condition in PeerConnectionKernel where file transfers arrived before peer was registered in active_peer_conns","Caused 'Unable to find key for inbound file transfer handle' warnings","Virtual connection was created immediately in protocol layer but kernel only registered peer after receiving PeerChannelCreated event","PeerChannelCreated event was delayed until after NAT hole punching completed","Fixed by registering peer connections early in active_peer_conns before attempting connection","Early registration prevents race where file transfers arrive during hole punching","Connection failures properly clean up the early registration","All peer connection tests now pass consistently without race condition warnings"],"createdAt":"2025-07-30T21:10:42.848Z","version":1}
{"type":"relation","from":"citadel_sdk","to":"citadel_proto","relationType":"depends on","createdAt":"2025-07-28T14:58:06.989Z","version":1}
{"type":"relation","from":"citadel_sdk","to":"citadel_crypt","relationType":"uses","createdAt":"2025-07-28T14:58:06.989Z","version":1}
{"type":"relation","from":"citadel_proto","to":"citadel_crypt","relationType":"uses","createdAt":"2025-07-28T14:58:06.989Z","version":1}
{"type":"relation","from":"Citadel Protocol","to":"citadel_sdk","relationType":"contains","createdAt":"2025-07-28T14:58:06.989Z","version":1}
{"type":"relation","from":"Citadel Protocol","to":"citadel_proto","relationType":"contains","createdAt":"2025-07-28T14:58:06.989Z","version":1}
{"type":"relation","from":"Citadel Protocol","to":"citadel_crypt","relationType":"contains","createdAt":"2025-07-28T14:58:06.989Z","version":1}